{
    "Format": "state_machine",
    "states": [
        {
            "id": "EMPTY",
            "transitions": {}
        },
        {
            "id": "sender_output_0",
            "transitions": {
                "init": [
                    [
                        "sequence",
                        ["_comment", "set the tag to chip impedance index 1"],
                        ["load_imm", 6, 1],
                        ["set_antenna", 6],
                        ["_comment", "wait 70 ticks before starting to send"],
                        ["load_imm", 4, 70],
                        ["set_timer", 4]
                    ],
                    "sender_output_1"
                ]
            }
        },
        {
            "id": "sender_output_1",
            "transitions": {
                "on_timer": [
                    [
                        "sequence",
                        ["_comment", "set the tag to chip impedance index 4"],
                        ["load_imm", 5, 4],
                        ["set_antenna", 5]
                    ],
                    "EMPTY"
                ]
            }
        },
        {
            "id": "reflector_output_0",
            "transitions": {
                "init": [
                    [
                        "sequence",
                        ["_comment", "set the tag to chip impedance index 1"],
                        ["load_imm", 0, 1],
                        ["set_antenna", 0],
                        ["_comment", "store imm value 1 in 2nd register"],
                        ["load_imm", 1, 1],
                        ["_comment", "store imm value 7 in 3rd register"],
                        ["load_imm", 3, 7],
                        ["_comment", "wait 10 ticks before starting to send"],
                        ["load_imm", 2, 10],
                        ["set_timer", 2],
                        ["_comment", "second half variable"],
                        ["load_imm", 4, 0]
                    ],
                    "reflector_output_0"
                ],
                "on_timer": [
                    [
                        "sequence",
                        ["_comment", "set the tag to chip next impedance index"],
                        ["add", 0, 0, 1],
                        ["set_antenna", 0],
                        ["_comment", "check if all indicies have been set"],
                        ["compare", 0 , 3]
                    ],
                    "reflector_output_1"
                ],
                "lt": [
                    [
                        "sequence",
                        ["_comment", "reset chip impedance counter"],
                        ["load_imm", 0, 0],
                        ["add", 4, 4, 1],
                        ["compare", 0 , 3]
                    ],
                    "reflector_output_1"
                ],
                "eq": [["_comment", "done"],"EMPTY"]
            }
        },
        {
            "id": "reflector_output_1",
            "transitions": {
                "eq": [
                    [
                        "sequence",
                        ["_comment", "part 1 done"],
                        ["compare", 4 , 1] 
                    ],
                    "reflector_output_0"
                ],
                "lt": [
                    [
                        "sequence",
                        ["_comment", "restart timer and loop back to previous state"],
                        ["set_timer", 2]
                    ],
                    "reflector_output_0"
                ]
                
            }
        },
        {
            "id": "receiver_input_0",
            "transitions": {
                "init": [
                    [
                        "sequence",
                        ["_comment", "wait 5 ticks before performing first reading"],
                        ["load_imm", 0, 5],
                        ["_comment", "setting loop variable"],
                        ["load_imm", 1, 0],
                        ["_comment", "setting loop end"],
                        ["load_imm", 2, 14],
                        ["_comment", "immediate value store"],
                        ["load_imm", 3, 1],
                        ["set_timer", 0]
                    ],
                    "receiver_input_0"
                ],
                "on_timer": [
                    [
                        "sequence",
                        ["_comment", "wait 10 ticks before performing second reading"],
                        ["save_voltage", 0],
                        ["add", 1 , 1, 3],
                        ["compare", 1, 2 ]
                    ],
                    "receiver_input_1"
                ]
            }
        },
        {
            "id": "receiver_input_1",
            "transitions": {
                "eq": [
                    ["_comment", "done"], 
                    "EMPTY"
                ],
                "lt": [
                    [
                        "sequence",
                        ["_comment", "wait 10 ticks before performing another reading"],
                        ["load_imm", 0, 10],
                        ["set_timer", 0]
                    ],
                    "receiver_input_0"
                ]
            }
        }
    ]
}
